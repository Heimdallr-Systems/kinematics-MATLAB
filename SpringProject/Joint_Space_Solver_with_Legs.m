function [Theta1_d,Theta2_d,Theta3_d] = Joint_Space_Solver_with_Legs(Theta1_0, Theta2_0, Theta3_0, r_II_B_d, T_I_B_d, r_II_c_d)
% This function will solve for desired joint space positions given a
% desired body position.
% r_II_B_d = [Bx;By;Bz];
%
% Initial Body Position
% r_II_B_0 = [x;y;z];
%
% initial joint positions
% Theta1_0 = [Theta1_leg1, Theta1_leg2, Theta1_leg3, Theta1_leg4]
% Theta2_0 = [Theta2_leg1, Theta2_leg2, Theta2_leg3, Theta2_leg4]
% Theta3_0 = [Theta3_leg1, Theta3_leg2, Theta3_leg3, Theta3_leg4]
%
% Initial Body Orientation wrt I
% T_I_B_0  = rotz(phi)roty(theta)rotx(psi)
%
% Desired Body Orientation wrt I
% T_I_B_d  = rotz(phi_d)roty(theta_d)rotx(psi_d)
%
% legs_on_gnd - logical array for telling if at least 3 or max four legs on
% gnd
% legs_on_gnd = [1/0,1/0,1/0,1/0];

% legs = find(legs_on_gnd == 1);
% legs_not = find(legs_on_gnd == 0);

% Desired Position

%if length(legs) == 4
Theta1_leg1 = Theta1_0(1);
Theta1_leg2 = Theta1_0(2);
Theta1_leg3 = Theta1_0(3);
Theta1_leg4 = Theta1_0(4);

Theta2_leg1 = Theta2_0(1);
Theta2_leg2 = Theta2_0(2);
Theta2_leg3 = Theta2_0(3);
Theta2_leg4 = Theta2_0(4);

Theta3_leg1 = Theta3_0(1);
Theta3_leg2 = Theta3_0(2);
Theta3_leg3 = Theta3_0(3);
Theta3_leg4 = Theta3_0(4);

% Intial position of contact points with respect to inertial
% [r_II_c_leg1, r_II_c_leg2, r_II_c_leg3, r_II_c_leg4] = CPos_wrt_I(Theta1_0,Theta2_0,Theta3_0,T_I_B_0,r_II_B_0);
r_II_c_d_leg1(:,1) = r_II_c_d(:,1);
r_II_c_d_leg2(:,1) = r_II_c_d(:,2);
r_II_c_d_leg3(:,1) = r_II_c_d(:,3);
r_II_c_d_leg4(:,1) = r_II_c_d(:,4);


X0 = [Theta1_leg1;Theta2_leg1;Theta3_leg1;Theta1_leg2;Theta2_leg2;Theta3_leg2;...
    Theta1_leg3;Theta2_leg3;Theta3_leg3;Theta1_leg4;Theta2_leg4;Theta3_leg4];

error = 1;
jj = 0;

% compute with Newton-Raphson Method until error is small, or 300
% iterations have passed

r_II_B_d_x = r_II_B_d(1);
r_II_B_d_y = r_II_B_d(2);
r_II_B_d_z = r_II_B_d(3);
Theta1_leg1 = Theta1_0(1);
Theta1_leg2 = Theta1_0(2);
Theta1_leg3 = Theta1_0(3);
Theta1_leg4 = Theta1_0(4);
Theta2_leg1 = Theta2_0(1);
Theta2_leg2 = Theta2_0(2);
Theta2_leg3 = Theta2_0(3);
Theta2_leg4 = Theta2_0(4);
Theta3_leg1 = Theta3_0(1);
Theta3_leg2 = Theta3_0(2);
Theta3_leg3 = Theta3_0(3);
Theta3_leg4 = Theta3_0(4);
r_II_c_0_x_leg1 = r_II_c_d_leg1(1);
r_II_c_0_y_leg1 = r_II_c_d_leg1(2);
r_II_c_0_z_leg1 = r_II_c_d_leg1(3);
r_II_c_0_x_leg2 = r_II_c_d_leg2(1);
r_II_c_0_y_leg2 = r_II_c_d_leg2(2);
r_II_c_0_z_leg2 = r_II_c_d_leg2(3);
r_II_c_0_x_leg3 = r_II_c_d_leg3(1);
r_II_c_0_y_leg3 = r_II_c_d_leg3(2);
r_II_c_0_z_leg3 = r_II_c_d_leg3(3);
r_II_c_0_x_leg4 = r_II_c_d_leg4(1);
r_II_c_0_y_leg4 = r_II_c_d_leg4(2);
r_II_c_0_z_leg4 = r_II_c_d_leg4(3);
T_I_B_d_1_1 = T_I_B_d(1,1);
T_I_B_d_1_2 = T_I_B_d(1,2);
T_I_B_d_1_3 = T_I_B_d(1,3);
T_I_B_d_2_1 = T_I_B_d(2,1);
T_I_B_d_2_2 = T_I_B_d(2,2);
T_I_B_d_2_3 = T_I_B_d(2,3);
T_I_B_d_3_1 = T_I_B_d(3,1);
T_I_B_d_3_2 = T_I_B_d(3,2);
T_I_B_d_3_3 = T_I_B_d(3,3);

while (error > 0.001) && (jj < 300)
    jj = jj+1;
    
    G = [
        r_II_c_0_x_leg1 - r_II_B_d_x + T_I_B_d_1_2*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) - T_I_B_d_1_1*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) + T_I_B_d_1_3*(sin(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta2_leg1))/100000 - 1143/40000)
 r_II_c_0_y_leg1 - r_II_B_d_y + T_I_B_d_2_2*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) - T_I_B_d_2_1*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) + T_I_B_d_2_3*(sin(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta2_leg1))/100000 - 1143/40000)
 r_II_c_0_z_leg1 - r_II_B_d_z + T_I_B_d_3_2*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) - T_I_B_d_3_1*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) + T_I_B_d_3_3*(sin(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta2_leg1))/100000 - 1143/40000)
 r_II_c_0_x_leg2 - r_II_B_d_x - T_I_B_d_1_2*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 + 7289/50000) + T_I_B_d_1_1*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 - 7289/50000) - T_I_B_d_1_3*(sin(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta2_leg2))/100000 + 1143/40000)
 r_II_c_0_y_leg2 - r_II_B_d_y - T_I_B_d_2_2*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 + 7289/50000) + T_I_B_d_2_1*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 - 7289/50000) - T_I_B_d_2_3*(sin(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta2_leg2))/100000 + 1143/40000)
 r_II_c_0_z_leg2 - r_II_B_d_z - T_I_B_d_3_2*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 + 7289/50000) + T_I_B_d_3_1*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 - 7289/50000) - T_I_B_d_3_3*(sin(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta2_leg2))/100000 + 1143/40000)
 r_II_c_0_x_leg3 - r_II_B_d_x + T_I_B_d_1_2*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 + 7289/50000) - T_I_B_d_1_1*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 - 7289/50000) + T_I_B_d_1_3*(sin(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta2_leg3))/100000 - 1143/40000)
 r_II_c_0_y_leg3 - r_II_B_d_y + T_I_B_d_2_2*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 + 7289/50000) - T_I_B_d_2_1*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 - 7289/50000) + T_I_B_d_2_3*(sin(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta2_leg3))/100000 - 1143/40000)
 r_II_c_0_z_leg3 - r_II_B_d_z + T_I_B_d_3_2*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 + 7289/50000) - T_I_B_d_3_1*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 - 7289/50000) + T_I_B_d_3_3*(sin(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta2_leg3))/100000 - 1143/40000)
 r_II_c_0_x_leg4 - r_II_B_d_x - T_I_B_d_1_2*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) + T_I_B_d_1_1*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) - T_I_B_d_1_3*(sin(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta2_leg4))/100000 + 1143/40000)
 r_II_c_0_y_leg4 - r_II_B_d_y - T_I_B_d_2_2*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) + T_I_B_d_2_1*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) - T_I_B_d_2_3*(sin(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta2_leg4))/100000 + 1143/40000)
 r_II_c_0_z_leg4 - r_II_B_d_z - T_I_B_d_3_2*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) + T_I_B_d_3_1*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) - T_I_B_d_3_3*(sin(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta2_leg4))/100000 + 1143/40000)
        ];
    dGdX = [[ - T_I_B_d_1_1*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000) - T_I_B_d_1_2*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000), T_I_B_d_1_1*((sin(Theta1_leg1)*sin(Theta2_leg1))/8 + (20467*cos(Theta2_leg1)*sin(Theta1_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta1_leg1)*sin(Theta2_leg1))/100000) - T_I_B_d_1_2*((cos(Theta1_leg1)*sin(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta1_leg1)*cos(Theta3_leg1)*sin(Theta2_leg1))/100000) + T_I_B_d_1_3*(cos(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*sin(Theta2_leg1)*sin(Theta3_leg1))/100000), T_I_B_d_1_1*((20467*cos(Theta2_leg1)*sin(Theta1_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta1_leg1)*sin(Theta2_leg1))/100000) - T_I_B_d_1_2*((20467*cos(Theta1_leg1)*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta1_leg1)*cos(Theta3_leg1)*sin(Theta2_leg1))/100000) + T_I_B_d_1_3*((20467*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*sin(Theta2_leg1)*sin(Theta3_leg1))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[ - T_I_B_d_2_1*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000) - T_I_B_d_2_2*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000), T_I_B_d_2_1*((sin(Theta1_leg1)*sin(Theta2_leg1))/8 + (20467*cos(Theta2_leg1)*sin(Theta1_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta1_leg1)*sin(Theta2_leg1))/100000) - T_I_B_d_2_2*((cos(Theta1_leg1)*sin(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta1_leg1)*cos(Theta3_leg1)*sin(Theta2_leg1))/100000) + T_I_B_d_2_3*(cos(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*sin(Theta2_leg1)*sin(Theta3_leg1))/100000), T_I_B_d_2_1*((20467*cos(Theta2_leg1)*sin(Theta1_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta1_leg1)*sin(Theta2_leg1))/100000) - T_I_B_d_2_2*((20467*cos(Theta1_leg1)*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta1_leg1)*cos(Theta3_leg1)*sin(Theta2_leg1))/100000) + T_I_B_d_2_3*((20467*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*sin(Theta2_leg1)*sin(Theta3_leg1))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[ - T_I_B_d_3_1*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000) - T_I_B_d_3_2*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000), T_I_B_d_3_1*((sin(Theta1_leg1)*sin(Theta2_leg1))/8 + (20467*cos(Theta2_leg1)*sin(Theta1_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta1_leg1)*sin(Theta2_leg1))/100000) - T_I_B_d_3_2*((cos(Theta1_leg1)*sin(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta1_leg1)*cos(Theta3_leg1)*sin(Theta2_leg1))/100000) + T_I_B_d_3_3*(cos(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*sin(Theta2_leg1)*sin(Theta3_leg1))/100000), T_I_B_d_3_1*((20467*cos(Theta2_leg1)*sin(Theta1_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta1_leg1)*sin(Theta2_leg1))/100000) - T_I_B_d_3_2*((20467*cos(Theta1_leg1)*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta1_leg1)*cos(Theta3_leg1)*sin(Theta2_leg1))/100000) + T_I_B_d_3_3*((20467*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*sin(Theta2_leg1)*sin(Theta3_leg1))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, T_I_B_d_1_1*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000) + T_I_B_d_1_2*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000), T_I_B_d_1_2*((cos(Theta1_leg2)*sin(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta1_leg2)*cos(Theta3_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_1_1*((sin(Theta1_leg2)*sin(Theta2_leg2))/8 + (20467*cos(Theta2_leg2)*sin(Theta1_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta1_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_1_3*(cos(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*sin(Theta2_leg2)*sin(Theta3_leg2))/100000), T_I_B_d_1_2*((20467*cos(Theta1_leg2)*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta1_leg2)*cos(Theta3_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_1_1*((20467*cos(Theta2_leg2)*sin(Theta1_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta1_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_1_3*((20467*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*sin(Theta2_leg2)*sin(Theta3_leg2))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, T_I_B_d_2_1*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000) + T_I_B_d_2_2*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000), T_I_B_d_2_2*((cos(Theta1_leg2)*sin(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta1_leg2)*cos(Theta3_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_2_1*((sin(Theta1_leg2)*sin(Theta2_leg2))/8 + (20467*cos(Theta2_leg2)*sin(Theta1_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta1_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_2_3*(cos(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*sin(Theta2_leg2)*sin(Theta3_leg2))/100000), T_I_B_d_2_2*((20467*cos(Theta1_leg2)*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta1_leg2)*cos(Theta3_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_2_1*((20467*cos(Theta2_leg2)*sin(Theta1_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta1_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_2_3*((20467*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*sin(Theta2_leg2)*sin(Theta3_leg2))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, T_I_B_d_3_1*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000) + T_I_B_d_3_2*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000), T_I_B_d_3_2*((cos(Theta1_leg2)*sin(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta1_leg2)*cos(Theta3_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_3_1*((sin(Theta1_leg2)*sin(Theta2_leg2))/8 + (20467*cos(Theta2_leg2)*sin(Theta1_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta1_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_3_3*(cos(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*sin(Theta2_leg2)*sin(Theta3_leg2))/100000), T_I_B_d_3_2*((20467*cos(Theta1_leg2)*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta1_leg2)*cos(Theta3_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_3_1*((20467*cos(Theta2_leg2)*sin(Theta1_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta1_leg2)*sin(Theta2_leg2))/100000) - T_I_B_d_3_3*((20467*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*sin(Theta2_leg2)*sin(Theta3_leg2))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, - T_I_B_d_1_1*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000) - T_I_B_d_1_2*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000), T_I_B_d_1_1*((sin(Theta1_leg3)*sin(Theta2_leg3))/8 + (20467*cos(Theta2_leg3)*sin(Theta1_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta1_leg3)*sin(Theta2_leg3))/100000) - T_I_B_d_1_2*((cos(Theta1_leg3)*sin(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta1_leg3)*cos(Theta3_leg3)*sin(Theta2_leg3))/100000) + T_I_B_d_1_3*(cos(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*sin(Theta2_leg3)*sin(Theta3_leg3))/100000), T_I_B_d_1_1*((20467*cos(Theta2_leg3)*sin(Theta1_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta1_leg3)*sin(Theta2_leg3))/100000) - T_I_B_d_1_2*((20467*cos(Theta1_leg3)*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta1_leg3)*cos(Theta3_leg3)*sin(Theta2_leg3))/100000) + T_I_B_d_1_3*((20467*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*sin(Theta2_leg3)*sin(Theta3_leg3))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, - T_I_B_d_2_1*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000) - T_I_B_d_2_2*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000), T_I_B_d_2_1*((sin(Theta1_leg3)*sin(Theta2_leg3))/8 + (20467*cos(Theta2_leg3)*sin(Theta1_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta1_leg3)*sin(Theta2_leg3))/100000) - T_I_B_d_2_2*((cos(Theta1_leg3)*sin(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta1_leg3)*cos(Theta3_leg3)*sin(Theta2_leg3))/100000) + T_I_B_d_2_3*(cos(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*sin(Theta2_leg3)*sin(Theta3_leg3))/100000), T_I_B_d_2_1*((20467*cos(Theta2_leg3)*sin(Theta1_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta1_leg3)*sin(Theta2_leg3))/100000) - T_I_B_d_2_2*((20467*cos(Theta1_leg3)*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta1_leg3)*cos(Theta3_leg3)*sin(Theta2_leg3))/100000) + T_I_B_d_2_3*((20467*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*sin(Theta2_leg3)*sin(Theta3_leg3))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, - T_I_B_d_3_1*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000) - T_I_B_d_3_2*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000), T_I_B_d_3_1*((sin(Theta1_leg3)*sin(Theta2_leg3))/8 + (20467*cos(Theta2_leg3)*sin(Theta1_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta1_leg3)*sin(Theta2_leg3))/100000) - T_I_B_d_3_2*((cos(Theta1_leg3)*sin(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta1_leg3)*cos(Theta3_leg3)*sin(Theta2_leg3))/100000) + T_I_B_d_3_3*(cos(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*sin(Theta2_leg3)*sin(Theta3_leg3))/100000), T_I_B_d_3_1*((20467*cos(Theta2_leg3)*sin(Theta1_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta1_leg3)*sin(Theta2_leg3))/100000) - T_I_B_d_3_2*((20467*cos(Theta1_leg3)*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta1_leg3)*cos(Theta3_leg3)*sin(Theta2_leg3))/100000) + T_I_B_d_3_3*((20467*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*sin(Theta2_leg3)*sin(Theta3_leg3))/100000),                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, T_I_B_d_1_1*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000) + T_I_B_d_1_2*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000), T_I_B_d_1_2*((cos(Theta1_leg4)*sin(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta1_leg4)*cos(Theta3_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_1_1*((sin(Theta1_leg4)*sin(Theta2_leg4))/8 + (20467*cos(Theta2_leg4)*sin(Theta1_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta1_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_1_3*(cos(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*sin(Theta2_leg4)*sin(Theta3_leg4))/100000), T_I_B_d_1_2*((20467*cos(Theta1_leg4)*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta1_leg4)*cos(Theta3_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_1_1*((20467*cos(Theta2_leg4)*sin(Theta1_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta1_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_1_3*((20467*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*sin(Theta2_leg4)*sin(Theta3_leg4))/100000)]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, T_I_B_d_2_1*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000) + T_I_B_d_2_2*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000), T_I_B_d_2_2*((cos(Theta1_leg4)*sin(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta1_leg4)*cos(Theta3_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_2_1*((sin(Theta1_leg4)*sin(Theta2_leg4))/8 + (20467*cos(Theta2_leg4)*sin(Theta1_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta1_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_2_3*(cos(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*sin(Theta2_leg4)*sin(Theta3_leg4))/100000), T_I_B_d_2_2*((20467*cos(Theta1_leg4)*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta1_leg4)*cos(Theta3_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_2_1*((20467*cos(Theta2_leg4)*sin(Theta1_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta1_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_2_3*((20467*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*sin(Theta2_leg4)*sin(Theta3_leg4))/100000)]
[                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                             0, T_I_B_d_3_1*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000) + T_I_B_d_3_2*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000), T_I_B_d_3_2*((cos(Theta1_leg4)*sin(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta1_leg4)*cos(Theta3_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_3_1*((sin(Theta1_leg4)*sin(Theta2_leg4))/8 + (20467*cos(Theta2_leg4)*sin(Theta1_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta1_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_3_3*(cos(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*sin(Theta2_leg4)*sin(Theta3_leg4))/100000), T_I_B_d_3_2*((20467*cos(Theta1_leg4)*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta1_leg4)*cos(Theta3_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_3_1*((20467*cos(Theta2_leg4)*sin(Theta1_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta1_leg4)*sin(Theta2_leg4))/100000) - T_I_B_d_3_3*((20467*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*sin(Theta2_leg4)*sin(Theta3_leg4))/100000)]
 ];
    
    
    %     G = G_func(Theta1_0, Theta2_0, Theta3_0, r_II_B_d, r_II_c_leg1, r_II_c_leg2, r_II_c_leg3, r_II_c_leg4, T_I_B_d);
    %     dGdX = dGdX_func(Theta1_0, Theta2_0, Theta3_0, r_II_B_d, r_II_c_leg1, r_II_c_leg2, r_II_c_leg3, r_II_c_leg4, T_I_B_d);
    
    Xplus = X0 - dGdX\G;
    
    Theta1_0 = [Xplus(1),Xplus(4),Xplus(7),Xplus(10)];
    Theta2_0 = [Xplus(2),Xplus(5),Xplus(8),Xplus(11)];
    Theta3_0 = [Xplus(3),Xplus(6),Xplus(9),Xplus(12)];
    
    Theta1_leg1 = Theta1_0(1);
    Theta1_leg2 = Theta1_0(2);
    Theta1_leg3 = Theta1_0(3);
    Theta1_leg4 = Theta1_0(4);
    Theta2_leg1 = Theta2_0(1);
    Theta2_leg2 = Theta2_0(2);
    Theta2_leg3 = Theta2_0(3);
    Theta2_leg4 = Theta2_0(4);
    Theta3_leg1 = Theta3_0(1);
    Theta3_leg2 = Theta3_0(2);
    Theta3_leg3 = Theta3_0(3);
    Theta3_leg4 = Theta3_0(4);
    
    %     Gplus = G_func(Theta1_0, Theta2_0, Theta3_0, r_II_B_d, r_II_c_leg1, r_II_c_leg2, r_II_c_leg3, r_II_c_leg4, T_I_B_d);
    
    Gplus = [
       r_II_c_0_x_leg1 - r_II_B_d_x + T_I_B_d_1_2*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) - T_I_B_d_1_1*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) + T_I_B_d_1_3*(sin(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta2_leg1))/100000 - 1143/40000)
 r_II_c_0_y_leg1 - r_II_B_d_y + T_I_B_d_2_2*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) - T_I_B_d_2_1*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) + T_I_B_d_2_3*(sin(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta2_leg1))/100000 - 1143/40000)
 r_II_c_0_z_leg1 - r_II_B_d_z + T_I_B_d_3_2*((41*cos(Theta1_leg1))/1000 + (cos(Theta1_leg1)*cos(Theta2_leg1))/8 + (20467*cos(Theta1_leg1)*cos(Theta2_leg1)*cos(Theta3_leg1))/100000 - (20467*cos(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) - T_I_B_d_3_1*((41*sin(Theta1_leg1))/1000 + (cos(Theta2_leg1)*sin(Theta1_leg1))/8 + (20467*cos(Theta2_leg1)*cos(Theta3_leg1)*sin(Theta1_leg1))/100000 - (20467*sin(Theta1_leg1)*sin(Theta2_leg1)*sin(Theta3_leg1))/100000 + 7289/50000) + T_I_B_d_3_3*(sin(Theta2_leg1)/8 + (20467*cos(Theta2_leg1)*sin(Theta3_leg1))/100000 + (20467*cos(Theta3_leg1)*sin(Theta2_leg1))/100000 - 1143/40000)
 r_II_c_0_x_leg2 - r_II_B_d_x - T_I_B_d_1_2*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 + 7289/50000) + T_I_B_d_1_1*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 - 7289/50000) - T_I_B_d_1_3*(sin(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta2_leg2))/100000 + 1143/40000)
 r_II_c_0_y_leg2 - r_II_B_d_y - T_I_B_d_2_2*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 + 7289/50000) + T_I_B_d_2_1*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 - 7289/50000) - T_I_B_d_2_3*(sin(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta2_leg2))/100000 + 1143/40000)
 r_II_c_0_z_leg2 - r_II_B_d_z - T_I_B_d_3_2*((41*cos(Theta1_leg2))/1000 + (cos(Theta1_leg2)*cos(Theta2_leg2))/8 + (20467*cos(Theta1_leg2)*cos(Theta2_leg2)*cos(Theta3_leg2))/100000 - (20467*cos(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 + 7289/50000) + T_I_B_d_3_1*((41*sin(Theta1_leg2))/1000 + (cos(Theta2_leg2)*sin(Theta1_leg2))/8 + (20467*cos(Theta2_leg2)*cos(Theta3_leg2)*sin(Theta1_leg2))/100000 - (20467*sin(Theta1_leg2)*sin(Theta2_leg2)*sin(Theta3_leg2))/100000 - 7289/50000) - T_I_B_d_3_3*(sin(Theta2_leg2)/8 + (20467*cos(Theta2_leg2)*sin(Theta3_leg2))/100000 + (20467*cos(Theta3_leg2)*sin(Theta2_leg2))/100000 + 1143/40000)
 r_II_c_0_x_leg3 - r_II_B_d_x + T_I_B_d_1_2*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 + 7289/50000) - T_I_B_d_1_1*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 - 7289/50000) + T_I_B_d_1_3*(sin(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta2_leg3))/100000 - 1143/40000)
 r_II_c_0_y_leg3 - r_II_B_d_y + T_I_B_d_2_2*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 + 7289/50000) - T_I_B_d_2_1*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 - 7289/50000) + T_I_B_d_2_3*(sin(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta2_leg3))/100000 - 1143/40000)
 r_II_c_0_z_leg3 - r_II_B_d_z + T_I_B_d_3_2*((41*cos(Theta1_leg3))/1000 + (cos(Theta1_leg3)*cos(Theta2_leg3))/8 + (20467*cos(Theta1_leg3)*cos(Theta2_leg3)*cos(Theta3_leg3))/100000 - (20467*cos(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 + 7289/50000) - T_I_B_d_3_1*((41*sin(Theta1_leg3))/1000 + (cos(Theta2_leg3)*sin(Theta1_leg3))/8 + (20467*cos(Theta2_leg3)*cos(Theta3_leg3)*sin(Theta1_leg3))/100000 - (20467*sin(Theta1_leg3)*sin(Theta2_leg3)*sin(Theta3_leg3))/100000 - 7289/50000) + T_I_B_d_3_3*(sin(Theta2_leg3)/8 + (20467*cos(Theta2_leg3)*sin(Theta3_leg3))/100000 + (20467*cos(Theta3_leg3)*sin(Theta2_leg3))/100000 - 1143/40000)
 r_II_c_0_x_leg4 - r_II_B_d_x - T_I_B_d_1_2*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) + T_I_B_d_1_1*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) - T_I_B_d_1_3*(sin(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta2_leg4))/100000 + 1143/40000)
 r_II_c_0_y_leg4 - r_II_B_d_y - T_I_B_d_2_2*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) + T_I_B_d_2_1*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) - T_I_B_d_2_3*(sin(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta2_leg4))/100000 + 1143/40000)
 r_II_c_0_z_leg4 - r_II_B_d_z - T_I_B_d_3_2*((41*cos(Theta1_leg4))/1000 + (cos(Theta1_leg4)*cos(Theta2_leg4))/8 + (20467*cos(Theta1_leg4)*cos(Theta2_leg4)*cos(Theta3_leg4))/100000 - (20467*cos(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) + T_I_B_d_3_1*((41*sin(Theta1_leg4))/1000 + (cos(Theta2_leg4)*sin(Theta1_leg4))/8 + (20467*cos(Theta2_leg4)*cos(Theta3_leg4)*sin(Theta1_leg4))/100000 - (20467*sin(Theta1_leg4)*sin(Theta2_leg4)*sin(Theta3_leg4))/100000 + 7289/50000) - T_I_B_d_3_3*(sin(Theta2_leg4)/8 + (20467*cos(Theta2_leg4)*sin(Theta3_leg4))/100000 + (20467*cos(Theta3_leg4)*sin(Theta2_leg4))/100000 + 1143/40000)
 
 ];
    
    error = norm(G - Gplus);
    
    X0 = Xplus;
    
end

Theta1_leg1 = Theta1_0(1);
Theta1_leg2 = Theta1_0(2);
Theta1_leg3 = Theta1_0(3);
Theta1_leg4 = Theta1_0(4);
Theta2_leg1 = Theta2_0(1);
Theta2_leg2 = Theta2_0(2);
Theta2_leg3 = Theta2_0(3);
Theta2_leg4 = Theta2_0(4);
Theta3_leg1 = Theta3_0(1);
Theta3_leg2 = Theta3_0(2);
Theta3_leg3 = Theta3_0(3);
Theta3_leg4 = Theta3_0(4);

Theta1_d_temp = [Theta1_leg1, Theta1_leg2, Theta1_leg3, Theta1_leg4];
Theta2_d_temp = [Theta2_leg1, Theta2_leg2, Theta2_leg3, Theta2_leg4];
Theta3_d_temp = [Theta3_leg1, Theta3_leg2, Theta3_leg3, Theta3_leg4];

Theta1_d(1) = Theta1_d_temp(1);
Theta1_d(2) = Theta1_d_temp(2);
Theta1_d(3) = Theta1_d_temp(3);
Theta1_d(4) = Theta1_d_temp(4);

Theta2_d(1) = Theta2_d_temp(1);
Theta2_d(2) = Theta2_d_temp(2);
Theta2_d(3) = Theta2_d_temp(3);
Theta2_d(4) = Theta2_d_temp(4);

Theta3_d(1) = Theta3_d_temp(1);
Theta3_d(2) = Theta3_d_temp(2);
Theta3_d(3) = Theta3_d_temp(3);
Theta3_d(4) = Theta3_d_temp(4);
end